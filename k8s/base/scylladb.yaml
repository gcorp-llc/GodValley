apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: scylla
spec:
  serviceName: scylla-headless
  replicas: 3
  selector:
    matchLabels:
      app: scylla
  template:
    metadata:
      labels:
        app: scylla
<<<<<<< HEAD
  spec:
  containers:
    - name: scylla
      image: scylladb/scylla:6.3
      resources:
        requests:
          memory: "2Gi"
          cpu: "1000m"
        limits:
          memory: "4Gi"
          cpu: "2000m"
      args:
        - --smp=2
        - --memory=2G
        - --overprovisioned=1
        - --api-address=0.0.0.0
      ports:
        - containerPort: 9042
          name: cql
        - containerPort: 9180
          name: prometheus
        - containerPort: 10000
          name: rest-api
      env:
        - name: SCYLLA_CLUSTER_NAME
          value: "multi-site-cluster"
      volumeMounts:
        - name: scylla-data
          mountPath: /var/lib/scylla
        - name: scylla-config
          mountPath: /etc/scylla
      livenessProbe:
        exec:
          command:
            - /bin/sh
            - -c
            - nodetool status | grep -E "^UN"
        initialDelaySeconds: 90
        periodSeconds: 30
      readinessProbe:
        exec:
          command:
            - /bin/sh
            - -c
            - nodetool status | grep -E "^UN"
        initialDelaySeconds: 60
        periodSeconds: 10
=======
    spec:
      containers:
        - name: scylla
          image: scylladb/scylla:6.3
          args: ["--seeds", "scylla-0.scylla-headless"]
          ports:
            - containerPort: 9042
            - containerPort: 7000
            - containerPort: 7001
            - containerPort: 10000
          volumeMounts:
            - name: scylla-data
              mountPath: /var/lib/scylla
  volumeClaimTemplates:
    - metadata:
        name: scylla-data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 2Gi
>>>>>>> 4159b8fc2d33391900f55a186b0901ebcd940baa

---
apiVersion: v1
kind: Service
metadata:
  name: scylla-headless
spec:
  clusterIP: None
  selector:
    app: scylla
  ports:
    - port: 9042
      name: cql
---
apiVersion: v1
kind: Service
metadata:
  name: scylla
spec:
  selector:
    app: scylla
  ports:
    - port: 9042
      targetPort: 9042
  type: ClusterIP
